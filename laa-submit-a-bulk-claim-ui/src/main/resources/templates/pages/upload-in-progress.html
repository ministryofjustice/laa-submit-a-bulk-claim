<!DOCTYPE HTML>
<html lang="en" class="govuk-template" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{ layout/main-layout :: layout(#{importInProgress.heading},~{::main}, ~{})}">
<main class="govuk-main-wrapper" id="main-content">

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

      <div class="moj-interruption-card">
        <div class="moj-interruption-card__content">
          <h1 class="moj-interruption-card__heading" th:text="#{importInProgress.heading}"/>
          <div class="moj-interruption-card__body">
            <p th:text="#{importInProgress.leadParagraph}"/>

            <p>
              <span class="govuk-!-font-weight-bold"
                    th:text="#{importInProgress.upload}"/>:
              <span id="bulk-submission-date"
                    th:if="${inProgressSummary?.uploadDate()}"
                    th:text="|${#temporals.format(inProgressSummary.uploadDate(),'d MMM yyyy')} at ${#temporals.format(inProgressSummary.uploadDate(),'hh:MM:SS')}|"/>
            </p>

            <p>
              <span class="govuk-!-font-weight-bold"
                    th:text="#{submission.properties.submissionReference}"/>:
              <span id="bulk-submission-id" th:text="${inProgressSummary?.submissionReference()}"/>
            </p>

            <p>
              <th:block th:if="${uploadedFilename != null}">
                <span class="govuk-!-font-weight-bold"
                      th:text="#{importInProgress.file}"/>:
                <span id="bulk-submission-file-name" th:text="${inProgressSummary?.fileName()}"/>
              </th:block>
            </p>
          </div>
          <div class="govuk-button-group moj-interruption-card__actions" id="actions-container">

            <a th:href="@{/search}" id="go-to-search-button" role="button" draggable="false"
               class="govuk-button govuk-button--inverse"
               data-module="govuk-button" th:text="#{importInProgress.goToSearch}"/>


            <script type="text/javascript">
              (function () {
                function copyReference() {
                  // Get the text field
                  var copyText = document.getElementById("bulk-submission-id");

                  // Copy the text inside the text field
                  navigator.clipboard.writeText(copyText.textContent);

                  // Create and show element was copied to clipboard
                  var notification = document.createElement('p');
                  notification.textContent = 'Submission reference copied to clipboard.';
                  notification.className = 'govuk-body';
                  notification.style.color = '#ffffff';
                  notification.style.marginTop = '0';
                  notification.style.marginBottom = '0';
                  notification.style.transition = 'opacity 5s';

                  var actionsContainer = document.getElementById('actions-container');
                  actionsContainer.appendChild(notification);

                  // Remove notification over 5 seconds
                  notification.style.transition = 'opacity 3s';
                  
                  setTimeout(function () {
                    notification.style.opacity = '0';
                    setTimeout(function () {
                      actionsContainer.removeChild(notification);
                    }, 3000);
                  }, 2000);

                }
                if (document.getElementById) {
                  var actionsContainer = document.getElementById('actions-container');
                  var copyToClipboardButton = document.createElement('a');
                  copyToClipboardButton.setAttribute('role', 'button');
                  copyToClipboardButton.setAttribute('draggable', 'false');
                  copyToClipboardButton.setAttribute('data-module', 'govuk-button');
                  copyToClipboardButton.className = 'govuk-button govuk-button--inverse';
                  copyToClipboardButton.textContent = /*[[#{importInProgress.copyButton}]]*/ 'Copy submission reference';
                  copyToClipboardButton.addEventListener('click', copyReference);
                  actionsContainer.appendChild(copyToClipboardButton);
                }
              })();
            </script>


          </div>
        </div>
      </div>

    </div>
  </div>

</main>
</html>